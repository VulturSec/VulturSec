<!DOCTYPE html>
<html lang="en-us"><head>


  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Android Game Hacking Series - Level 3</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description"
    content="Android Game Hacking Series">

    
    <link rel="icon" href="https://vultursec.com/images/favicon.ico" type="image/gif" sizes="16x16">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="Description" content="Enter your description here">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" as="style" onload="this.onload=null;this.rel=&#39;stylesheet&#39;"/>

    
    <link rel="stylesheet" href="https://vultursec.com/css/style.css">

    
    <script src="https://vultursec.com/js/lazysizes.min.js"></script>

    
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link href="https://vultursec.com/css/css2" rel="stylesheet">


  <!--Favicon-->
  <link rel="shortcut icon" href="https://vultursec.com/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="https://vultursec.com/images/favicon.ico" type="image/x-icon">


</head>
<body class="white-page">


    <header class="fixed">
      <div class="container">
        <nav class="navbar navbar-light">
          

          <a class="navbar-brand aos-init aos-animate" href="https://vultursec.com/index.html" data-aos="fade-down" data-aos-delay="300"><img src="https://vultursec.com/images/logo.png" alt="Logo" class="img-responsive"></a>
          <div class="right-container">
            <ul class="social-links">
              <li>
                <a href="https://twitter.com/vultursec" target="_blank"><i class="fab fa-twitter"></i></a>
              </li>
              <li>
                <a href="https://linkedin.com/company/vultursec" target="_blank"><i class="fab fa-linkedin-in"></i></a>
              </li> 
              <li>
                <a href="https://github.com/vultursec" target="_blank"><i class="fab fa-github"></i></a>
              </li>
            </ul>
            <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              
              <img src="https://vultursec.com/images/menu-open.png" alt="Menu" class="img-responsive">
            </button>
          </div>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <img src="https://vultursec.com/images/image-close.png" alt="Menu" class="img-responsive">
            </button>
            <div class="navbar-wrapper">
              <a class="navbar-brand visible-mobile aos-init aos-animate" href="https://vultursec.com/index.html" data-aos="fade-down" data-aos-delay="300"><img src="https://vultursec.com/images/logo.png" alt="Logo" class="img-responsive"></a>
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a href="https://vultursec.com/index.html#home">Home</a>
                </li>
                <li class="nav-item">
                  <a href="https://vultursec.com/index.html#about">About</a>
                </li>
                <li class="nav-item">
                  <a href="https://vultursec.com/index.html#services">Services</a>
                </li>
                <li class="nav-item">
                  <a href="https://vultursec.com/index.html#how-we-work">How we work</a>
                </li>
                <li class="nav-item">
                  <a href="https://vultursec.com/index.html#contact">Contact us</a>
                </li>
                <li class="nav-item">
                  <a href="https://vultursec.com/blog/">Blog</a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </header>




	


<section class="single-post-banner">
  <div class="container">
    <div class="row">
      <div class="col-md-4 col-sm-6 col-12">
        <div class="content">
          <div
            class="section-heading big"
            data-aos="fade-down"
            data-aos-delay="100"
          >
            <h1>Android Game Hacking Series - Level 3</h1>
          </div>
          <div class="author-meta-details">
            Posted by VulturSec Team, on 18 Dec, 2023 
          </div>
          <div class="section-text" data-aos="fade-in" data-aos-delay="300">
            <p>
              Introduction to Android Game Hacking and its techniques.
Hello everyone! Here is our third post on Android Game Hacking.
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-sm-6 col-12">
        <div class="image" data-aos="fade-left" data-aos-delay="500">
          <img
            src="/images/blog/game-hacking-1/pixel-dungeon-2.jpeg"
            alt="Blog Image"
            class="img-responsive"
          />
        </div>
      </div>
    </div>
  </div>
</section>

	



<section class="single-post-section">
  <div class="container">
    
    <div class="row">
      
      <div class="section-heading">
        <h3>Android Game Hacking Series - Level 3</h3>
      </div>
      <div class="col-lg-9 order-1 order-lg-1">
        
        <div class="row">
        <div class="col-12 my-4">
          <div class="border-bottom"></div>
        </div>
        
        <div class="col-12 mb-5 text">
          <p><strong>Introduction to Android Game Hacking and its techniques.</strong></p>
<p>Hello everyone! Here is our third post on <strong>Android Game Hacking</strong>. In the previous blog post we worked on hacks in native (ARM) libraries and its memory. You can check the previous blog posts here:</p>
<p><strong><a href="https://vultursec.com/blog/android-mobile-hacking-1/" title="Android Game Hacking - Level 1">Android Game Hacking - Level 1</a></strong></p>
<p><strong><a href="https://vultursec.com/blog/android-mobile-hacking-2/" title="Android Game Hacking - Level 2">Android Game Hacking - Level 2</a></strong></p>
<p>In this blog post we will work on hacking games developed in Java (for Android), we will create some hacks and in the following blog post we will work on a mod menu to patch the application and activate the hacks on runtime.</p>
<p>For the blog post we will use the following rogue like game: <strong><a href="https://f-droid.org/packages/com.watabou.pixeldungeon/">Pixeldungeon</a></strong></p>
<p>As the game is developed in Java we will use Frida (<a href="https://frida.re/">https://frida.re/</a>) to patch the application in runtime. This will be executed directly on the process, which will make the hacks not persistent. In the following blog post we will make the hack persistent with a mod menu.</p>
<p>The use of Frida has several benefits:</p>
<ul>
<li>If the game were ported for PC the same hack could be used, as Frida injects behavior at the VM level, and it could be ported to different processor architectures.</li>
<li>The patch is generated in javascript based on a documented API (<a href="https://frida.re/docs/javascript-api/#java">https://frida.re/docs/javascript-api/#java</a>) instead of dealing with Smali or other type of low level language.</li>
<li>It is easy to develop, test and fix scripts while being generated as no compiling or injection is required.</li>
</ul>
<p>The only hard restriction is to have the device or emulator with root capabilities. There is a way to inject Frida in non-rooted devices but we will not cover it on this blog post.</p>
<p>The setup to work is the following one:</p>
<p><img src="/images/blog/game-hacking-3/frida_setup.png" alt="Mobile Game Hacking: Frida Setup"></p>
<p><strong>About the game</strong></p>
<p>Pixel Dungeon is a roguelike RPG game, and the objective of the game is go through all the levels of a dungeon. The player can choose between four character classes (Warrior, Mage, Rogue &amp; Huntress), which have different abilities and stats. The character has different stats, a character level and HP. The player looses when the character’s HP gets to 0. In order to level-up the character has to kill monsters that will spawn while the user crawls the dungeon.</p>
<p>The dungeon is divided in levels. Each level is divided in different rooms which are connected through corridors, with stairs to go up and down the dungeon. Each level is generated randomly when the user gets into it. The algorithm assures that there is always an accesible stair to go up and down.</p>
<p>The developer of the game added a mechanics related to food consumption. The character needs to eat food regularly in order to not get to the starving state, where the player will loose 1 HP after he does a couple of steps. Food is rarely scarce, so the player needs to manage all the resources in order to avoid getting to that state. Because of this, the easiest strategies of farming monsters and getting levels won’t work. Also as everything is generated randomnly, the player will not be able to find food to give the character, and they will get to the starving state.</p>
<p><strong>Pixel Dungeon concepts and internals</strong></p>
<p>The application has the following classes related to the character:</p>
<p><img src="/images/blog/game-hacking-3/hero-classes.png" alt="Mobile Game Hacking: Hero Class Diagram"></p>
<p>From this class diagram the most important attributes that will be used in the algorithms are:</p>
<ul>
<li>Char.pos: position of the character in the map.</li>
<li>Char.HT: temporary hitpoints. When this value gets to 0 the character dies, finishing the game.</li>
</ul>
<p>The main stats can be found in the Hero class:</p>
<ul>
<li>Hero.attackSkill</li>
<li>Hero.defenseSkill</li>
<li>Hero.STR</li>
<li>Hero.exp</li>
</ul>
<p>In order to make the character do things, the application calls the <strong>Hero.call()</strong> method. This method checks the type of the <strong>HeroAction</strong> stored in the <strong>curAction</strong> attribute and then it calls the <strong>actXxxx(HeroAction)</strong> based on it. As an example if in the <strong>curAction</strong> the application stored a <strong>HeroAction.Move</strong> object, whenever the <strong>Hero.call()</strong> is invoked, the Hero will end up calling the <strong>actMove()</strong> method, sending as a parameter the <strong>HeroAction.Move</strong> from the <strong>curAction</strong> attribute.</p>
<p>In the following sections we will work with different hacks.</p>
<p><strong>Hack 1: Refill full life</strong></p>
<p>The script to refill the full life of the character is the following one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Char</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.Char&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">choose</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.hero.Hero&#34;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">onMatch</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">hero</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">cast</span>(<span style="color:#a6e22e">hero</span>,<span style="color:#a6e22e">Char</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">char</span>.<span style="color:#a6e22e">HP</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">char</span>.<span style="color:#a6e22e">HT</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">onComplete</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> () { }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>The first thing you will note is that this script is written in plain javascript, which some specific functions that are included by default by Frida to interact with a Java process.</p>
<p>In the previous script we use three Frida APIs. The first one is <strong>Java.perform</strong> which is used to tell the frida-server to run the content inside of the process Java VM.</p>
<p>The second one is <strong>Java.use</strong>, which imports a class already loaded in the process VM in order to be used in the script. Frida creates a wrapper on the class in order to abstract the developer of the internals of Java.</p>
<p>The third one is <strong>Java.choose</strong>, which iterates over the VM heap to list all instances of a desired class (in this case the Hero class). In this specific case we use this method to retrieve the Hero instance in order to change the current health. If you come from a game hacking background, this would be like finding the memory address of the health of the character and changing it.</p>
<p>In order to run it you&rsquo;ll need to have the frida-server running in the Android device, and connect in the following way (executing frida-cli in the terminal of the host).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>frida -U <span style="color:#e6db74">&#34;Pixel Dungeon&#34;</span>
</span></span></code></pre></div><p>If everything goes right you should see something similar to the following screen:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>     ____
</span></span><span style="display:flex;"><span>    / _  |   Frida 16.1.4 - A world-class dynamic instrumentation toolkit
</span></span><span style="display:flex;"><span>   | <span style="color:#f92672">(</span>_| |
</span></span><span style="display:flex;"><span>    &gt; _  |   Commands:
</span></span><span style="display:flex;"><span>   /_/ |_|       help      -&gt; Displays the help system
</span></span><span style="display:flex;"><span>   . . . .       object?   -&gt; Display information about <span style="color:#e6db74">&#39;object&#39;</span>
</span></span><span style="display:flex;"><span>   . . . .       exit/quit -&gt; Exit
</span></span><span style="display:flex;"><span>   . . . .
</span></span><span style="display:flex;"><span>   . . . .   More info at https://frida.re/docs/home/
</span></span><span style="display:flex;"><span>   . . . .
</span></span><span style="display:flex;"><span>   . . . .   Connected to Android Emulator <span style="color:#ae81ff">5554</span> <span style="color:#f92672">(</span>id<span style="color:#f92672">=</span>emulator-5554<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                                                                                
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Android Emulator 5554::Pixel Dungeon <span style="color:#f92672">]</span>-&gt;
</span></span></code></pre></div><p>Then you should paste and execute the content from the example, and you will see the character&rsquo;s health full again.</p>
<p><strong>Hack 2: True damage</strong></p>
<p>We will generate a hack that will impact the health of the enemies around the character. It could be useful in case we face some kind of ghost, which are not always hittable (unless you have a special sword).</p>
<p><img src="/images/blog/game-hacking-3/ghost.png" alt="Mobile Game Hacking: Ghost"></p>
<p>In this case we use the private attribute called <strong>_visibleEnemies</strong> on the instance of our Hero, and then per each visible enemy we change the HP value. This will be translated as true damage as the armor and modifications will not be applied to the damage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">choose</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.hero.Hero&#34;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">onMatch</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">hero</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">amount_damage</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Mob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.mobs.Mob&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Char</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.Char&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">iterator</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hero</span>.<span style="color:#a6e22e">_visibleEnemies</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">iterator</span>();        
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">iterator</span>.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">enemyMob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">iterator</span>.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">theMob</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">cast</span>(<span style="color:#a6e22e">enemyMob</span>,<span style="color:#a6e22e">Mob</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">theChar</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">cast</span>(<span style="color:#a6e22e">enemyMob</span>,<span style="color:#a6e22e">Char</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">theChar</span>.<span style="color:#a6e22e">damage</span>(<span style="color:#a6e22e">amount_damage</span>, <span style="color:#a6e22e">theChar</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">theMob</span>.<span style="color:#a6e22e">$className</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">theChar</span>.<span style="color:#a6e22e">HP</span>.<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>                      
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">onComplete</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> () { }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p><strong>Hack 3: Change character stats</strong></p>
<p>For this hack we simply need to get the Hero instance and work on the different values a hero has, like STR, which is related to the hit damage (for warriors).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Char</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.Char&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">choose</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.hero.Hero&#34;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">onMatch</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">hero</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">hero</span>.<span style="color:#a6e22e">STR</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">onComplete</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> () { }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p><strong>Hack 4: Remove bad buffs</strong></p>
<p>In the game there are different buffs. Some of them are positive and some of them are negative, so with this cheat we want to remove from the hero some negative buffs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">isBadBuff</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">className</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">className</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;Satiety&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">className</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;Haste&#39;</span>)) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>( <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">choose</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.hero.Hero&#34;</span>, {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">onMatch</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">hero</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Char</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.Char&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">character</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">cast</span>(<span style="color:#a6e22e">hero</span>,<span style="color:#a6e22e">Char</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">iterator</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">character</span>.<span style="color:#a6e22e">_buffs</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">iterator</span>();
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">buffToRemove</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Array();
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">iterator</span>.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">buff</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">iterator</span>.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isBadBuff</span>(<span style="color:#a6e22e">buff</span>.<span style="color:#a6e22e">$className</span>)) {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">buffToRemove</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">buff</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">buff</span>.<span style="color:#a6e22e">$className</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">buffToRemove</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">character</span>.<span style="color:#a6e22e">_buffs</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">buffToRemove</span>[<span style="color:#a6e22e">i</span>]);    
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">onComplete</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> () { }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    });
</span></span></code></pre></div><p><strong>Hack 5: Make the level visible</strong></p>
<p>In order to understand the script created for this hack we need to understand how the map is created and managed in the game. The following diagram shows the main classes related to the level and map creation and update:</p>
<p><img src="/images/blog/game-hacking-3/pixel-dungeon-levels.png" alt="Mobile Game Hacking: Pixel Dungeon Level"></p>
<p>The map is divided in discrete units of space, that we will call “pixels”. Each pixel has a terrain type (the information about the values are stored in the Terrain class). Each terrain type is associated with an integer value, which can also be seen in the Terrain type. The map is basically a matrix of pixels. In the game this is stored as an array, and whenever the application needs a position, it makes count to convert the array to a matrix. This can be done, because the width of the map is a constant. Each pixel has an id, that is the position of the pixel in the array, which will be used to execute operations and validations during the game lifecycle.</p>
<p>The following image shows the values of the positions in a Room:</p>
<p><img src="/images/blog/game-hacking-3/pixel-dungeon-map-position.png" alt="Mobile Game Hacking: Pixel Dungeon Map Position"></p>
<p>The following script was used to print the positions of the cells:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">printMap</span>(<span style="color:#a6e22e">charObj</span>, <span style="color:#a6e22e">level</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">charObj</span>.<span style="color:#a6e22e">pos</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">pos</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">32</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">32</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">RANGE</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minY</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">maxY</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">y</span><span style="color:#f92672">+</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">31</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minX</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">maxX</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">x</span><span style="color:#f92672">+</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">31</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">minY</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">maxY</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">line</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">minX</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">maxX</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posPrint</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">j</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//values in Terrain.java
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">posPrint</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">pos</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">line</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;* &#34;</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">line</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">posPrint</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span>;
</span></span><span style="display:flex;"><span>            } 
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">line</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () { 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">choose</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.hero.Hero&#34;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">onMatch</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">hero</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">heroObject</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hero</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//cast a Char
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">charClass</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.actors.Char&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">charObj</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">cast</span>(<span style="color:#a6e22e">hero</span>,<span style="color:#a6e22e">charClass</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Dungeon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.Dungeon&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">level</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Dungeon</span>.<span style="color:#a6e22e">level</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">printMap</span>(<span style="color:#a6e22e">charObj</span>, <span style="color:#a6e22e">level</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">onComplete</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> () { }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Another important attribute from the Level class is visited, which has an Array of booleans. This array has one item per pixel, and it stores if the user visited the pixel or not. Visit a pixel means it gets into the field of view of the character.</p>
<p><img src="/images/blog/game-hacking-3/pixel-dungeon-map-visited.png" alt="Mobile Game Hacking: Pixel Dungeon Visited"></p>
<p>In this case the visited = true is mapped to 1 and the visited = false is mapped to 0. The only change from the above script was the printMap function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">printMap</span>(<span style="color:#a6e22e">charObj</span>, <span style="color:#a6e22e">level</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">charObj</span>.<span style="color:#a6e22e">pos</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">pos</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">32</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">32</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">RANGE</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minY</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">maxY</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">y</span><span style="color:#f92672">+</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">31</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minX</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">maxX</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">x</span><span style="color:#f92672">+</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">31</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">minY</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">maxY</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">line</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">minX</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">maxX</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posPrint</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">j</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//values in Terrain.java
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">posPrint</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">pos</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">line</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;* &#34;</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">level</span>.<span style="color:#a6e22e">visited</span>.<span style="color:#a6e22e">value</span>[<span style="color:#a6e22e">posPrint</span>]) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">line</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;1 &#34;</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">line</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;0 &#34;</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">line</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <strong>fieldOfView</strong> attribute holds which pixels can be seen by the character. It depends on the place where the user is, the max range of sight (8 pixels), and if there is any object that blocks the sight (like a wall or a closed door). This attribute is reloaded each time the character moves.</p>
<p><img src="/images/blog/game-hacking-3/pixel-dungeon-map-fieldofview.png" alt="Mobile Game Hacking: Pixel Dungeon Level"></p>
<p>In this case the visible pixels are mapped to 1 and the others are mapped to 0. The only change from the above script was the <strong>printMap</strong> function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">printMap</span>(<span style="color:#a6e22e">charObj</span>, <span style="color:#a6e22e">level</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">charObj</span>.<span style="color:#a6e22e">pos</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">pos</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">32</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">pos</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">32</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">RANGE</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minY</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">y</span><span style="color:#f92672">-</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">maxY</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">y</span><span style="color:#f92672">+</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">31</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">minX</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">maxX</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">x</span><span style="color:#f92672">+</span><span style="color:#a6e22e">RANGE</span>,<span style="color:#ae81ff">31</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">minY</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">maxY</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">line</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">minX</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">maxX</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">posPrint</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">j</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//values in Terrain.java
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">posPrint</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">pos</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">line</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;* &#34;</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">level</span>.<span style="color:#a6e22e">fieldOfView</span>.<span style="color:#a6e22e">value</span>[<span style="color:#a6e22e">posPrint</span>]) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">line</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;1 &#34;</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">line</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;0 &#34;</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">line</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With all this information, we can now understand how to change the field of view in order to make everything visible:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Dungeon</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.Dungeon&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">Dungeon</span>.<span style="color:#a6e22e">level</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">LENGTH</span>.<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Arrays</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;java.util.Arrays&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">arrayLength</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Dungeon</span>.<span style="color:#a6e22e">visible</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">arrayLength</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Dungeon</span>.<span style="color:#a6e22e">visible</span>.<span style="color:#a6e22e">value</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Dungeon</span>.<span style="color:#a6e22e">level</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">visited</span>.<span style="color:#a6e22e">value</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Dungeon</span>.<span style="color:#a6e22e">level</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">mapped</span>.<span style="color:#a6e22e">value</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Dungeon</span>.<span style="color:#a6e22e">level</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">fieldOfView</span>.<span style="color:#a6e22e">value</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Level</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.watabou.pixeldungeon.levels.Level&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Level</span>.<span style="color:#a6e22e">updateFieldOfView</span>.<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#66d9ef">char</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fieldOfView</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p><strong>Conclusion</strong></p>
<p>We created several scripts in Frida to patch the application in runtime in order to generate cheats for it. In order to do so we need to execute the reverse engineering of the Java classes stored in the apk file. This is required in order to understand what to patch and how to do it.</p>
<p>The remaining exercise for this application is to make the hacks persistent. So far we need to run frida-server in the device, and load the scripts manually (kind of the way cheats are loaded with Game Guardian). This is not the standard way to generate moded applications. In the following post we will go through the process of creation of a mod menu for Frida.</p>
<p>If you want us to create a video about this hacks, reach out on our social networks and we will create the content for you :)</p>
<p><strong>If you are a mobile game developer and you want to have an assessment on your mobile game, reach us, and we can help you to make your game hacker-proof!</strong></p>

        </div>
        </div>
      </div>
<!-- sidebar -->
<aside class="col-lg-3 order-2 order-lg-2">
  <!-- categories -->
  <div class="bg-white mb-5">
    <h4 class="mb-4 h4-bold">Categories</h4>
    <ul class="list-unstyled" style='line-height: 1.2; font-family: "Poppins", sans-serif; -webkit-font-smoothing: antialiased; color: #5c5c77;'>
      <li class="border-bottom"><a href="/categories/gamehacking/" class="d-block pb-3 mt-3">Gamehacking</a></li>
      <li class="border-bottom"><a href="/categories/methodologies/" class="d-block pb-3 mt-3">Methodologies</a></li>
    </ul>
  </div>
  <!-- tags -->
  <div class="bg-white mb-5">
    <h4 class="mb-4 h4-bold">Tags</h4>
    <ul class="list-inline tag-list" style='line-height: 1.2; font-family: "Poppins", sans-serif; -webkit-font-smoothing: antialiased; color: #5c5c77;'>
      <li class="list-inline-item mb-2"><a href="/tags/assessment/">Assessment</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/cloud/">Cloud</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/game/">Game</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/hacking/">Hacking</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/java/">Java</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/methodology/">Methodology</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/mobile/">Mobile</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/red-team/">Red team</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/sdlc/">SDLC</a></li>
      <li class="list-inline-item mb-2"><a href="/tags/web/">Web</a></li>
    </ul>
  </div>
  <!-- latest post -->
  <div class="bg-white">
    <h4 class="mb-4 h4-bold">Latest Article</h4>
    <!-- post-item -->
    
    <div class="media border-bottom border-color pb-3 mb-3" style='display: flex;'>
      <a href="https://vultursec.com/blog/android-mobile-hacking-3/"><img class="mr-3 post-thumb-sm" style="margin-right: 1rem!important;" src="https://vultursec.com/images/blog/game-hacking-1/pixel-dungeon-2.jpeg"></a>
      <div class="media-body" style='line-height: 1.2; font-family: "Poppins", sans-serif; -webkit-font-smoothing: antialiased; font-size: 15px; color: #5c5c77;'>
        <a href="https://vultursec.com/blog/android-mobile-hacking-3/">
          <h5 class="mt-0" style='font-size: 18px; color: #1e1e4b; font-family: "futura-bold"; font-weight: 700; line-height: 1.2;'>Android Game Hacking Series - Level 3</h5>
        </a>
        18 Dec 2023
      </div>
    </div>
    
    <div class="media border-bottom border-color pb-3 mb-3" style='display: flex;'>
      <a href="https://vultursec.com/blog/fractured-online-hacked/"><img class="mr-3 post-thumb-sm" style="margin-right: 1rem!important;" src="https://vultursec.com/images/blog/fractured-online-hacked/fractured-online-hacked.webp"></a>
      <div class="media-body" style='line-height: 1.2; font-family: "Poppins", sans-serif; -webkit-font-smoothing: antialiased; font-size: 15px; color: #5c5c77;'>
        <a href="https://vultursec.com/blog/fractured-online-hacked/">
          <h5 class="mt-0" style='font-size: 18px; color: #1e1e4b; font-family: "futura-bold"; font-weight: 700; line-height: 1.2;'>Reflection of Hack on Fractured Online</h5>
        </a>
        26 Nov 2023
      </div>
    </div>
    
    <div class="media border-bottom border-color pb-3 mb-3" style='display: flex;'>
      <a href="https://vultursec.com/blog/android-mobile-hacking-2/"><img class="mr-3 post-thumb-sm" style="margin-right: 1rem!important;" src="https://vultursec.com/images/blog/game-hacking-1/pixel-dungeon-2.jpeg"></a>
      <div class="media-body" style='line-height: 1.2; font-family: "Poppins", sans-serif; -webkit-font-smoothing: antialiased; font-size: 15px; color: #5c5c77;'>
        <a href="https://vultursec.com/blog/android-mobile-hacking-2/">
          <h5 class="mt-0" style='font-size: 18px; color: #1e1e4b; font-family: "futura-bold"; font-weight: 700; line-height: 1.2;'>Android Game Hacking Series - Level 2</h5>
        </a>
        14 Nov 2023
      </div>
    </div>
    
  </div>
</aside>
<!-- /sidebar -->
    </div>
  </div>
</section>




<footer>
     <script type="text/javascript">
      let searchField = document.getElementById("searchField");
      let queryText = window.location.search.split("=")[1];
      if (queryText) {
        searchField.value = queryText.includes("-")
          ? queryText.replaceAll("-", " ")
          : queryText;
      }
      let searchValue = "";
      function handleChange(e) {
        searchValue = e.value;
      }
      document
        .getElementById("searchForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          window.location.href = `/search.html?val=${searchValue.replaceAll(
            " ",
            "-"
          )}`;
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js" defer=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.0/js/bootstrap.min.js" defer=""></script>
    <script src="https://vultursec.com/js/aos.js" defer=""></script>
    <script src="https://vultursec.com/js/custom.js" defer=""></script>
 </footer>

<grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></body>

</html>